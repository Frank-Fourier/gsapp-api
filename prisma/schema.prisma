// Prisma schema file
// SISTEMA CODICI E SOTTOCODICI

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TipologiaRitenuta {
  QUATTRO
  VENTI
  VENTITRE
  ZERO
}

enum CausaliSomme {
  AUTONOMO
  CU
  MONOMANDATARIO
  PLURIMANDATARIO
  COMMISSIONARIO
  MEDIATORE
  PROCACCIATORE
  APPALTATORE
  DIVERSI
  OCCASIONALE
  PROFESSIONISTA
}

enum TipologiaCondominio {
  PREVALENZA_RESIDENZIALE
  STANDARD
  RESIDENZIALE
  COMMERCIALE
  PREVALENZA_COMMERCIALE
  SUPER
  MINIMO
  MULTIPROPREITA
}

enum TipologiaAnagrafica {
  FISICA
  GIURIDICAPERSONE
  GIURIDICACAPITALI
}

enum TipologiaCassa {
  QUATTRO
  CINQUE
  ZERO
}

enum TipologiaIVA {
  ZERO
  QUATTRO
  DIECI
  VENTIDUE
}

enum TipologiaImmobile {
  A1
  A2
  A3
  A4
  A5
  A6
  A7
  A8
  A9
  A10
  A11
  B1
  B2
  B3
  B4
  B5
  B6
  B7
  B8
  C1
  C2
  C3
  C4
  C5
  C6
  C7
  D1
  D2
  D3
  D4
  D5
  D6
  D7
  D8
  D9
  D10
  E1
  E2
  E3
  E4
  E5
  E6
  E7
  E8
  E9
}

enum TipologiaFondo {
  CASSA
  SPECIALI
  TFR
}

enum TipologiaGestione {
  ORDINARIA
  STRAORDINARIA
  UTENZE_PRIVATE
}

model ProfiloAmministratore {
  id          Int          @id @default(autoincrement())
  nome        String
  cognome     String
  email       String
  password    String
  documenti   String[]
  allegati    String[]
  logo        String
  anagrafiche Anagrafica[]
  fornitori   Fornitore[]
  dipendenti  Dipendente[]
  condomini   Condominio[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Anagrafica {
  id                 Int                   @id @default(autoincrement())
  email              String
  emailPec           String
  tipologia          TipologiaAnagrafica
  nome               String
  cognome            String
  ragioneSociale     String? //se societa
  responsabile       String?
  codiceFiscale      String
  partitaIva         String
  nazioneResidenza   String
  comuneResidenza    String
  indirizzoResidenza String
  capResidenza       String
  nazioneDomicilio   String
  comuneDomicilio    String
  indirizzoDomicilio String
  capDomicilio       String
  dataNascita        DateTime
  luogoNascita       String
  telefono           String
  cellulare          String
  note               String
  documenti          String[]
  allegati           String[]
  amministratoreId   Int
  amministratore     ProfiloAmministratore @relation(fields: [amministratoreId], references: [id])
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
}

model Fornitore {
  id                  Int                   @id @default(autoincrement())
  email               String
  emailPec            String
  tipologia           TipologiaAnagrafica
  nome                String
  cognome             String
  ragioneSociale      String? //se societa
  responsabile        String?
  codiceFiscale       String //controllo
  partitaIva          String //controllo
  nazioneResidenza    String
  comuneResidenza     String
  indirizzoResidenza  String
  capResidenza        String
  nazioneDomicilio    String
  comuneDomicilio     String
  indirizzoDomicilio  String
  capDomicilio        String
  nazioneSedeLegale   String
  comuneSedeLegale    String
  indirizzoSedeLegale String
  capSedeLegale       String
  dataNascita         DateTime
  luogoNascita        String
  telefono            String //controllo
  cellulare           String //controllo
  note                String
  nomeBanca           String
  iban                String
  cassaPrevidenza     TipologiaCassa
  inps                String?
  iva1                TipologiaIVA? @default(ZERO)
  iva2                TipologiaIVA?
  iva3                TipologiaIVA?
  tipoRitenuta        TipologiaRitenuta
  causaliSommeErogate CausaliSomme
  cciaa               String?
  inail               String?
  albo                String?
  documenti           String[]
  allegati            String[]
  amministratoreId    Int
  amministratore      ProfiloAmministratore @relation(fields: [amministratoreId], references: [id])
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
}

model Dipendente {
  id                  Int                   @id @default(autoincrement())
  email               String
  emailPec            String
  nome                String
  cognome             String
  codiceFiscale       String //controllo
  nazioneResidenza    String
  comuneResidenza     String
  indirizzoResidenza  String
  capResidenza        String
  nazioneDomicilio    String
  comuneDomicilio     String
  indirizzoDomicilio  String
  capDomicilio        String
  dataNascita         DateTime
  luogoNascita        String
  telefono            String //controllo
  cellulare           String //controllo
  note                String
  nomeBanca           String
  iban                String
  causaliSommeErogate CausaliSomme
  documenti           String[]
  allegati            String[]
  amministratoreId    Int
  amministratore      ProfiloAmministratore @relation(fields: [amministratoreId], references: [id])
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
}

model Condominio {
  id                       Int                       @id @default(autoincrement())
  codice                   String?                   @unique
  tipologia                TipologiaCondominio
  denominazione            String
  codiceFiscale            String
  comune                   String
  indirizzo                String
  cap                      String
  sezioneUrbana            String
  foglio                   Int
  particella               Int
  totalSuperficie          Float // derivato
  totaleUnita              Int // derivato
  totaleVani               Float // derivato
  posizioneINPS            String
  posizioneINAIL           String
  luogoAssemblea1          String
  luogoAssemblea2          String
  decimaliMillesimi        Int
  descrizione              String
  allegati                 String[]
  dataPresaInCarico        DateTime
  amministratoreId         Int
  amministratore           ProfiloAmministratore     @relation(fields: [amministratoreId], references: [id])
  datiPatrimonialiIniziali DatiPatrimonialiIniziali?
  unitaImmobiliari         UnitaImmobiliare[]
  tabelle                  Tabella[]
  contiMastro              ContoMastro[]
  risorse                  Risorsa[]
  fondi                    Fondo[]
  transazioni              Transazione[]
  gestioni                 Gestione[]
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
}

model UnitaImmobiliare {
  id                      Int               @id @default(autoincrement())
  tipologia               TipologiaImmobile
  subalterno              String
  superficie              Float
  vani                    Int
  scala                   String
  piano                   String
  interno                 String
  note                    String
  nudaProprietaAttiva     String[] //Struct with data start
  usufruttoAttivo         String[] //Struct with data start
  proprietarioAttivo      String[] //Struct with data start
  nudaProprietaPrecedente String[] //Struct with data start (optional) and end 
  usufruttoPrecendente    String[] //Struct with data start (optional) and end
  proprietarioPrecedente  String[] //Struct with data start (optional) and end
  conduttorePrecedente    String[] //Struct with data start (optional) and end
  condominioId            Int
  condominio              Condominio        @relation(fields: [condominioId], references: [id])
  transazioni             Transazione[]
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
}

model Tabella {
  id                       Int        @id @default(autoincrement())
  denominazione            String
  totaleMillesimi          Int
  ripartizioneMillesimi    String[]
  percentualeNudaProprieta String[]
  percentualeUsufrutto     String[]
  percentualeProprieta     String[]
  percentualeConduttore    String[]
  descrizione              String
  condominioId             Int
  condominio               Condominio @relation(fields: [condominioId], references: [id])
  updatedAt                DateTime   @updatedAt
  createdAt                DateTime   @default(now())
}

model ContoMastro {
  id           Int        @id @default(autoincrement())
  descrizione  String
  note         String
  tabellaId    Int // riferimento a Tabella
  conti        String[]
  condominioId Int
  condominio   Condominio @relation(fields: [condominioId], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Risorsa {
  id              Int           @id @default(autoincrement())
  saldo           Float
  denominazione   String
  descrizione     String
  istitutoCredito String
  agenzia         String?
  iban            String?
  codiceBIC       String?
  note            String?
  condominioId    Int
  condominio      Condominio    @relation(fields: [condominioId], references: [id])
  transazioni     Transazione[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Fondo {
  id            Int            @id @default(autoincrement())
  saldo         Float
  tipologia     TipologiaFondo
  denominazione String
  descrizione   String
  condominioId  Int
  condominio    Condominio     @relation(fields: [condominioId], references: [id])
  transazioni   Transazione[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Transazione {
  id                     Int               @id @default(autoincrement())
  data                   DateTime
  importo                Float
  descrizione            String?
  riferimento            String
  provenienzaFornitore   String
  provenienzaAnagrafica  String
  destinazioneFornitore  String
  destinazioneAnagrafica String
  condominioId           Int
  condominio             Condominio        @relation(fields: [condominioId], references: [id])
  unitaImmobiliareId     Int?
  unitaImmobiliare       UnitaImmobiliare? @relation(fields: [unitaImmobiliareId], references: [id])
  risorsaId              Int
  risorsa                Risorsa           @relation(fields: [risorsaId], references: [id])
  fondoId                Int?
  fondo                  Fondo?            @relation(fields: [fondoId], references: [id])
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
}

model DatiPatrimonialiIniziali {
  id                        Int        @id @default(autoincrement())
  debitiUnitaImmobiliari    Int[]
  debitiDettaglio           String[]
  creditiUnitaImmobiliari   Int[]
  dettaglioUnitaImmobiliare String[]
  debitiFornitori           Int[]
  dettaglioFornitori        String[]
  fornitoriCrediti          Int[]
  dettaglioFornitoriCrediti String[]
  risorseGestione           String[]
  saldoRisorse              Float[]
  fondiGestione             String[]
  consistenzaFondo          Float[]
  descrizione               String
  condominioId              Int        @unique
  condominio                Condominio @relation(fields: [condominioId], references: [id])
  createdAt                 DateTime   @default(now())
  updatedAt                 DateTime   @updatedAt
}

model Gestione {
  id                        Int               @id @default(autoincrement())
  tipologia                 TipologiaGestione
  debitiUnitaImmobiliari    Int[]
  debitiDettaglio           String[]
  creditiUnitaImmobiliari   Int[]
  dettaglioUnitaImmobiliare String[]
  debitiFornitori           Int[]
  dettaglioFornitori        String[]
  fornitoriCrediti          Int[]
  dettaglioFornitoriCrediti String[]
  denominazione             String
  descrizione               String
  condominioId              Int
  condominio                Condominio        @relation(fields: [condominioId], references: [id])
  createdAt                 DateTime          @default(now())
  updatedAt                 DateTime          @updatedAt
}
